"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateTables = exports.validateEntities = void 0;
const decorators_1 = require("./decorators");
async function validateEntities(knex) {
    const entities = decorators_1.getEntities();
    for (const entity of entities) {
        const doesTableExists = await knex.schema.hasTable(entity.tableName);
        if (doesTableExists === false) {
            throw new Error(`Table "${entity.tableName}" of class "${entity.entityClass.name}" does not exist in database.`);
        }
        const columns = decorators_1.getColumnProperties(entity.entityClass);
        for (const column of columns) {
            if (column.isForeignKey) {
                continue;
            }
            const doesColumnExists = await knex.schema.hasColumn(entity.tableName, column.name);
            if (doesColumnExists === false) {
                throw new Error(`Column "${column.name}" of table "${entity.tableName}" of class "${entity.entityClass.name}" does not exist in database.`);
            }
        }
    }
}
exports.validateEntities = validateEntities;
exports.validateTables = validateEntities;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGVFbnRpdGllcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWxpZGF0ZUVudGl0aWVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLDZDQUFnRTtBQUV6RCxLQUFLLFVBQVUsZ0JBQWdCLENBQUMsSUFBVTtJQUM3QyxNQUFNLFFBQVEsR0FBRyx3QkFBVyxFQUFFLENBQUM7SUFFL0IsS0FBSyxNQUFNLE1BQU0sSUFBSSxRQUFRLEVBQUU7UUFDM0IsTUFBTSxlQUFlLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFckUsSUFBSSxlQUFlLEtBQUssS0FBSyxFQUFFO1lBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMsVUFBVSxNQUFNLENBQUMsU0FBUyxlQUFlLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSwrQkFBK0IsQ0FBQyxDQUFDO1NBQ3BIO1FBRUQsTUFBTSxPQUFPLEdBQUcsZ0NBQW1CLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXhELEtBQUssTUFBTSxNQUFNLElBQUksT0FBTyxFQUFFO1lBQzFCLElBQUksTUFBTSxDQUFDLFlBQVksRUFBRTtnQkFDckIsU0FBUzthQUNaO1lBRUQsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXBGLElBQUksZ0JBQWdCLEtBQUssS0FBSyxFQUFFO2dCQUM1QixNQUFNLElBQUksS0FBSyxDQUFDLFdBQVcsTUFBTSxDQUFDLElBQUksZUFBZSxNQUFNLENBQUMsU0FBUyxlQUFlLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSwrQkFBK0IsQ0FBQyxDQUFDO2FBQy9JO1NBQ0o7S0FDSjtBQUNMLENBQUM7QUF4QkQsNENBd0JDO0FBRVksUUFBQSxjQUFjLEdBQUcsZ0JBQWdCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBLbmV4IH0gZnJvbSAna25leCc7XG5pbXBvcnQgeyBnZXRDb2x1bW5Qcm9wZXJ0aWVzLCBnZXRFbnRpdGllcyB9IGZyb20gJy4vZGVjb3JhdG9ycyc7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUVudGl0aWVzKGtuZXg6IEtuZXgpIHtcbiAgICBjb25zdCBlbnRpdGllcyA9IGdldEVudGl0aWVzKCk7XG5cbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiBlbnRpdGllcykge1xuICAgICAgICBjb25zdCBkb2VzVGFibGVFeGlzdHMgPSBhd2FpdCBrbmV4LnNjaGVtYS5oYXNUYWJsZShlbnRpdHkudGFibGVOYW1lKTtcblxuICAgICAgICBpZiAoZG9lc1RhYmxlRXhpc3RzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUYWJsZSBcIiR7ZW50aXR5LnRhYmxlTmFtZX1cIiBvZiBjbGFzcyBcIiR7ZW50aXR5LmVudGl0eUNsYXNzLm5hbWV9XCIgZG9lcyBub3QgZXhpc3QgaW4gZGF0YWJhc2UuYCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjb2x1bW5zID0gZ2V0Q29sdW1uUHJvcGVydGllcyhlbnRpdHkuZW50aXR5Q2xhc3MpO1xuXG4gICAgICAgIGZvciAoY29uc3QgY29sdW1uIG9mIGNvbHVtbnMpIHtcbiAgICAgICAgICAgIGlmIChjb2x1bW4uaXNGb3JlaWduS2V5KSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGRvZXNDb2x1bW5FeGlzdHMgPSBhd2FpdCBrbmV4LnNjaGVtYS5oYXNDb2x1bW4oZW50aXR5LnRhYmxlTmFtZSwgY29sdW1uLm5hbWUpO1xuXG4gICAgICAgICAgICBpZiAoZG9lc0NvbHVtbkV4aXN0cyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvbHVtbiBcIiR7Y29sdW1uLm5hbWV9XCIgb2YgdGFibGUgXCIke2VudGl0eS50YWJsZU5hbWV9XCIgb2YgY2xhc3MgXCIke2VudGl0eS5lbnRpdHlDbGFzcy5uYW1lfVwiIGRvZXMgbm90IGV4aXN0IGluIGRhdGFiYXNlLmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVUYWJsZXMgPSB2YWxpZGF0ZUVudGl0aWVzO1xuIl19